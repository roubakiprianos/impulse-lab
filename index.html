<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Impulse Lab</title>
  <link rel="stylesheet" href="style.css?v=10">
  <!-- Supabase JS Client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <!-- Chart.js for performance graphs -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

  <!-- ANIMATED BACKGROUND -->
  <div class="background-animation">
    <div class="shape shape-1"></div>
    <div class="shape shape-2"></div>
    <div class="shape shape-3"></div>
    <div class="shape shape-4"></div>
    <div class="shape shape-5"></div>
    <div class="shape shape-6"></div>
    <div class="shape shape-7"></div>
    <div class="shape shape-8"></div>
    <div class="shape shape-9"></div>
    <div class="shape shape-10"></div>
    <div class="shape shape-11"></div>
    <div class="shape shape-12"></div>
  </div>

  <!-- MUSIC CONTROL -->
  <button id="music-toggle" class="music-toggle" title="Toggle Music">
    <span id="music-icon">üîá</span>
  </button>

  <!-- AUTH MODAL -->
  <div id="auth-modal" class="modal hidden">
    <div class="modal-content">
      <button id="auth-close" class="modal-close">&times;</button>
      <h2 id="auth-title" class="modal-title">Sign In</h2>
      <form id="auth-form">
        <div id="signup-fields" class="signup-fields hidden">
          <div class="form-group">
            <label for="auth-username">Username</label>
            <input type="text" id="auth-username" placeholder="Your display name" minlength="3" maxlength="20">
          </div>
          <div class="form-group">
            <label for="auth-country">Country</label>
            <select id="auth-country">
              <option value="">Select your country</option>
              <option value="AF">Afghanistan</option>
              <option value="AL">Albania</option>
              <option value="DZ">Algeria</option>
              <option value="AR">Argentina</option>
              <option value="AU">Australia</option>
              <option value="AT">Austria</option>
              <option value="BE">Belgium</option>
              <option value="BR">Brazil</option>
              <option value="BG">Bulgaria</option>
              <option value="CA">Canada</option>
              <option value="CL">Chile</option>
              <option value="CN">China</option>
              <option value="CO">Colombia</option>
              <option value="HR">Croatia</option>
              <option value="CY">Cyprus</option>
              <option value="CZ">Czech Republic</option>
              <option value="DK">Denmark</option>
              <option value="EG">Egypt</option>
              <option value="EE">Estonia</option>
              <option value="FI">Finland</option>
              <option value="FR">France</option>
              <option value="DE">Germany</option>
              <option value="GR">Greece</option>
              <option value="HK">Hong Kong</option>
              <option value="HU">Hungary</option>
              <option value="IS">Iceland</option>
              <option value="IN">India</option>
              <option value="ID">Indonesia</option>
              <option value="IE">Ireland</option>
              <option value="IL">Israel</option>
              <option value="IT">Italy</option>
              <option value="JP">Japan</option>
              <option value="KR">South Korea</option>
              <option value="LV">Latvia</option>
              <option value="LT">Lithuania</option>
              <option value="LU">Luxembourg</option>
              <option value="MY">Malaysia</option>
              <option value="MX">Mexico</option>
              <option value="NL">Netherlands</option>
              <option value="NZ">New Zealand</option>
              <option value="NO">Norway</option>
              <option value="PK">Pakistan</option>
              <option value="PE">Peru</option>
              <option value="PH">Philippines</option>
              <option value="PL">Poland</option>
              <option value="PT">Portugal</option>
              <option value="RO">Romania</option>
              <option value="RU">Russia</option>
              <option value="SA">Saudi Arabia</option>
              <option value="SG">Singapore</option>
              <option value="SK">Slovakia</option>
              <option value="SI">Slovenia</option>
              <option value="ZA">South Africa</option>
              <option value="ES">Spain</option>
              <option value="SE">Sweden</option>
              <option value="CH">Switzerland</option>
              <option value="TW">Taiwan</option>
              <option value="TH">Thailand</option>
              <option value="TR">Turkey</option>
              <option value="UA">Ukraine</option>
              <option value="AE">United Arab Emirates</option>
              <option value="GB">United Kingdom</option>
              <option value="US">United States</option>
              <option value="VN">Vietnam</option>
              <option value="OTHER">Other</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label for="auth-email">Email</label>
          <input type="email" id="auth-email" required placeholder="your@email.com">
        </div>
        <div class="form-group">
          <label for="auth-password">Password</label>
          <input type="password" id="auth-password" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" minlength="6">
        </div>
        <p id="auth-error" class="auth-error hidden"></p>
        <button type="submit" id="auth-submit" class="btn btn-primary">Sign In</button>
      </form>
      <p class="auth-switch">
        <span id="auth-switch-text">Don't have an account?</span>
        <button id="auth-switch-btn" class="btn-link">Sign Up</button>
      </p>
    </div>
  </div>

  <!-- HOME SCREEN -->
  <section id="screen-home" class="screen">
    <div class="card">
      <h1 class="title">Impulse Lab</h1>
      <p class="subtitle">Test your impulse control and reaction speed</p>

      <!-- Sign In Prompt (shown when not logged in) -->
      <div id="auth-prompt" class="auth-prompt">
        <p class="auth-prompt-text">Sign in to save progress</p>
        <div class="auth-buttons">
          <button id="btn-sign-in" class="btn btn-auth">Sign In</button>
          <button id="btn-sign-up" class="btn btn-auth-secondary">Create Account</button>
        </div>
      </div>

      <!-- User Status Bar (shown when logged in) -->
      <div id="user-bar" class="user-bar hidden">
        <span id="user-email" class="user-email"></span>
        <button id="btn-history" class="btn-icon" title="View History">üìä</button>
        <button id="btn-leaderboard" class="btn-icon" title="Leaderboard">üèÜ</button>
        <button id="btn-logout" class="btn-icon" title="Sign Out">üö™</button>
      </div>

      <!-- Campaign Status Card -->
      <div id="campaign-status" class="campaign-status">
        <div class="campaign-header">
          <span id="campaign-badge" class="campaign-badge">üå± Novice</span>
          <span id="campaign-lives" class="campaign-lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
        </div>
        <div class="campaign-stats">
          <div class="campaign-stat">
            <span class="campaign-stat-label">Level</span>
            <span id="campaign-level" class="campaign-stat-value">1</span>
          </div>
          <div class="campaign-stat">
            <span class="campaign-stat-label">Best</span>
            <span id="campaign-highest" class="campaign-stat-value">1</span>
          </div>
        </div>
        <button id="btn-campaign" class="btn btn-primary btn-campaign">Play Campaign</button>
      </div>

      <!-- Divider -->
      <div class="divider">
        <span>or</span>
      </div>

      <!-- Focus Lab Section (Standalone) -->
      <div id="focus-lab-section" class="focus-lab-section">
        <div class="focus-lab-header">
          <h3 class="focus-lab-title">üß† Focus Lab</h3>
          <p class="focus-lab-desc">Test sustained attention with variable tempo</p>
        </div>
        <div class="focus-lab-content">
          <div class="selector-group">
            <label for="focus-difficulty">Difficulty</label>
            <select id="focus-difficulty">
              <option value="easy">Easy (~1.5 min)</option>
              <option value="normal" selected>Normal (~2 min)</option>
              <option value="hard">Hard (~2.5 min)</option>
            </select>
          </div>
          <button id="btn-focus-lab" class="btn btn-focus">Start Focus Lab</button>
        </div>
      </div>

      <!-- Divider -->
      <div class="divider">
        <span>or</span>
      </div>

      <!-- Free Play Section -->
      <div id="freeplay-options" class="freeplay-section">
        <h3 class="freeplay-title">Free Play</h3>
        <div class="selectors">
          <div class="selector-group">
            <label for="mode-select">Mode</label>
            <select id="mode-select"></select>
          </div>
          <div class="selector-group">
            <label for="difficulty-select">Difficulty</label>
            <select id="difficulty-select"></select>
          </div>
        </div>
        <button id="btn-start" class="btn btn-ghost">Start Free Play</button>
      </div>
    </div>
  </section>

  <!-- GAME SCREEN -->
  <section id="screen-game" class="screen hidden">
    <div class="game-container">
      <!-- Back button -->
      <button id="btn-game-back" class="btn-game-back" title="Back to Home">‚úï</button>

      <!-- Campaign HUD (hidden in freeplay) -->
      <div class="game-hud">
        <span id="level-display" class="hud-item hidden">Level 1</span>
        <span id="lives-display" class="hud-item hidden">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
        <span id="streak-display" class="hud-item hidden">üî• 0</span>
      </div>

      <div class="game-info">
        <span id="trial-counter">Trial 1 / 25</span>
        <span id="time-left">~20s left</span>
      </div>

      <div id="tap-area" class="tap-area">
        <div id="symbol" class="symbol"></div>
        <div id="symbols-container" class="symbols-container hidden"></div>
      </div>

      <p class="hint">Tap when it's blue. Stay still otherwise.</p>
    </div>
  </section>

  <!-- RESULTS SCREEN -->
  <section id="screen-results" class="screen hidden">
    <div class="card">
      <h1 id="results-title" class="title">Results</h1>

      <!-- Unlock Notification -->
      <div id="unlock-notification" class="unlock-notification hidden"></div>

      <!-- Campaign Results -->
      <div id="campaign-results" class="campaign-results hidden"></div>

      <!-- Vigilance Results (attention drift over time) -->
      <div id="vigilance-results" class="vigilance-results hidden">
        <h3 class="vigilance-title">Attention Over Time</h3>
        <div class="vigilance-quarters">
          <div class="vigilance-quarter">
            <span class="quarter-label">Q1</span>
            <div class="quarter-bar"><div id="q1-bar" class="quarter-fill"></div></div>
            <span id="q1-rt" class="quarter-rt">‚Äî</span>
          </div>
          <div class="vigilance-quarter">
            <span class="quarter-label">Q2</span>
            <div class="quarter-bar"><div id="q2-bar" class="quarter-fill"></div></div>
            <span id="q2-rt" class="quarter-rt">‚Äî</span>
          </div>
          <div class="vigilance-quarter">
            <span class="quarter-label">Q3</span>
            <div class="quarter-bar"><div id="q3-bar" class="quarter-fill"></div></div>
            <span id="q3-rt" class="quarter-rt">‚Äî</span>
          </div>
          <div class="vigilance-quarter">
            <span class="quarter-label">Q4</span>
            <div class="quarter-bar"><div id="q4-bar" class="quarter-fill"></div></div>
            <span id="q4-rt" class="quarter-rt">‚Äî</span>
          </div>
        </div>
        <p id="vigilance-comment" class="vigilance-comment"></p>
      </div>

      <div class="results-grid">
        <div class="result-item">
          <span class="result-label">Hits</span>
          <span id="results-hits" class="result-value">0</span>
        </div>
        <div class="result-item">
          <span class="result-label">Misses</span>
          <span id="results-misses" class="result-value">0</span>
        </div>
        <div class="result-item">
          <span class="result-label">False Taps</span>
          <span id="results-false" class="result-value">0</span>
        </div>
        <div class="result-item">
          <span class="result-label">Avg RT</span>
          <span id="results-rt" class="result-value">0 ms</span>
        </div>
      </div>

      <div class="score-container">
        <span class="score-label">Score</span>
        <span id="results-score" class="score-value">0</span>
        <span class="score-max">/ 100</span>
      </div>

      <p id="results-pass-score" class="pass-score hidden">Need 50 to pass</p>

      <p id="results-comment" class="comment"></p>

      <p id="difficulty-suggestion" class="difficulty-suggestion hidden"></p>

      <div class="button-group">
        <button id="btn-next-level" class="btn btn-primary hidden">Next Level</button>
        <button id="btn-play-again" class="btn btn-primary">Play Again</button>
        <button id="btn-home" class="btn btn-ghost">Back to Home</button>
      </div>
    </div>
  </section>

  <!-- HISTORY SCREEN -->
  <section id="screen-history" class="screen hidden">
    <div class="card history-card">
      <div class="history-header">
        <h1 class="title">Performance History</h1>
        <button id="btn-history-close" class="btn-icon">‚úï</button>
      </div>

      <!-- Time Filter -->
      <div class="history-filters">
        <button class="filter-btn active" data-range="today">Today</button>
        <button class="filter-btn" data-range="week">This Week</button>
        <button class="filter-btn" data-range="month">This Month</button>
        <button class="filter-btn" data-range="all">All Time</button>
      </div>

      <!-- Chart Container -->
      <div class="chart-container">
        <canvas id="history-chart"></canvas>
      </div>

      <!-- Stats Summary -->
      <div class="history-stats">
        <div class="history-stat">
          <span class="history-stat-value" id="history-sessions">0</span>
          <span class="history-stat-label">Sessions</span>
        </div>
        <div class="history-stat">
          <span class="history-stat-value" id="history-avg-score">‚Äî</span>
          <span class="history-stat-label">Avg Score</span>
        </div>
        <div class="history-stat">
          <span class="history-stat-value" id="history-best-time">‚Äî</span>
          <span class="history-stat-label">Best Time</span>
        </div>
      </div>

      <!-- Recent Sessions List -->
      <div class="history-list">
        <h3 class="history-list-title">Recent Sessions</h3>
        <div id="history-list-items" class="history-list-items">
          <p class="history-empty">No sessions yet. Play Focus Lab to start tracking!</p>
        </div>
      </div>

      <button id="btn-history-back" class="btn btn-ghost">Back to Home</button>
    </div>
  </section>

  <!-- LEADERBOARD SCREEN -->
  <section id="screen-leaderboard" class="screen hidden">
    <div class="card leaderboard-card">
      <div class="leaderboard-header">
        <h1 class="title">Leaderboard</h1>
        <button id="btn-leaderboard-close" class="btn-icon">‚úï</button>
      </div>

      <!-- Mode Filter -->
      <div class="leaderboard-filters">
        <button class="leaderboard-filter-btn active" data-mode="all">All</button>
        <button class="leaderboard-filter-btn" data-mode="focusLab">Focus Lab</button>
        <button class="leaderboard-filter-btn" data-mode="campaign">Campaign</button>
      </div>

      <!-- Leaderboard List -->
      <div id="leaderboard-list" class="leaderboard-list">
        <div class="leaderboard-loading">Loading...</div>
      </div>

      <button id="btn-leaderboard-back" class="btn btn-ghost">Back to Home</button>
    </div>
  </section>

  <script src="supabase.js?v=4"></script>
  <script src="app.js?v=4"></script>
</body>
</html>
